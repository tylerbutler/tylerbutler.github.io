<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>    Engineer 0.3.1 Released    : Tyler Butler
</title>

                    
    <link rel="alternate" type="application/atom+xml"
          title="Tyler Butler Atom Feed"
          href="/feeds/atom.xml"/>

                
                                                        <link rel="stylesheet"
                      href="/static/engineer/lib/foundation/stylesheets/grid.css">
                <link rel="stylesheet"
                      href="/static/engineer/lib/foundation/stylesheets/mobile.css">

                <!--[if lt IE 9]>
                    <link rel="stylesheet" href="/static/engineer/lib/foundation/stylesheets/ie.css">
                <![endif]-->
                        
                    
                    
                    <link rel="stylesheet" href="/static/theme/stylesheets/dark_rainbow.css" type="text/css"/>
        
                
                                    
            <script type="text/javascript"
            src="http://use.typekit.net/vty2qol.js"></script>
    <script type="text/javascript">
        try {
            Typekit.load();
        }
        catch (e) {
        }
    </script>
    
            <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26061862-1']);
    _gaq.push(['_setDomainName', 'tylerbutler.com']);

    // track speed for all users; traffic is low enough this shouldn't be a problem
    _gaq.push(['_setSiteSpeedSampleRate', 100]);
    
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>    
                        <script src="/static/engineer/lib/modernizr-2.6.2.min.js"
                    type="text/javascript"></script>
            
            <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if offline -->
            <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
            <script>
                window.jQuery || document.write('<script src="/static/engineer/lib/jquery-1.10.2.min.js"><\/script>')
            </script>    
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
</head>
<body class=""><!--[if lt IE 7]>
    <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
<![endif]-->    <div class="container">            <header id="primary" class="row">                                            <h1 class="five columns">
                            <a href="/">                                    tyler
                                    <span class="highlight">butler</span>
                                </a>
                        </h1>
                                                        <nav class="seven columns">                            <ul class="nav navbar-nav">
    
                <li class="current">
        <a href="/">articles</a></li>
                <li>
        <a href="/projects">projects</a></li>
</ul>

                        </nav>
                </header>
        <div class="row">                <section id="main" class="twelve columns"
                         role="main">    <div class="row">
            <div class="post-info two columns">
            <div class="post-date">
                                    <div class="month">AUG</div>
                    <div class="day">07</div>
                    <div class="year">2012</div>
                    <div class="permalink">
                        <a href="/2012/08/engineer-0-3-1-released/"
                           title="Permanent link to 'Engineer 0.3.1 Released'">∞</a>
                    </div>
                            </div>
                                        <ul class="tags">
                                            <li><a href="/tag/engineer">engineer</a>
                        </li>
                                            <li><a href="/tag/project">project</a>
                        </li>
                                    </ul>
                    </div>
                            <article class="post-content ten columns">
                <time datetime="2012-08-07 PDT"
                      pubdate=""></time>
                <header>
                    <h1>
                        <a href="        /2012/08/engineer-0-3-1-released/">Engineer 0.3.1 Released</a>
                                            </h1>
                </header>
                                    <p>I pushed out a new version of Engineer &#8211; 0.3.1 &#8211; this weekend. While 0.3.1 is a minor release to fix a couple of major bugs that slipped through, 0.3.0 was a pretty major release. A majority of the new stuff is under the covers or developer-focused, so it might not seem like a big deal &#8211; but it is. With this release I think Engineer is stable enough for me to start hyping it a bit more, so you can anticipate that over the next few&nbsp;months. </p>
<p>The full <a href="http://engineer.readthedocs.org/en/latest/changelog.html#version-0-3-0-july-22-2012">release notes</a> go into more details about the specifics, but there are two major features I added that are particularly interesting from a development perspective: the new plugin architecture, and the Jekyll/Octopress compatibility&nbsp;work.</p>
<!-- more -->

<h2>Plugin&nbsp;Architecture</h2>
<p>Before I go into details about the plugin architecture, a disclaimer: I&#8217;m not yet completely happy with it, and it&#8217;s still a work in&nbsp;progress.</p>
<p>Since Engineer is a glorified text parser, it makes sense to have some degree of customization over exactly how that parsing happens. While Engineer already has a number of options and ways to customize exactly how it works, there&#8217;s always room for more. Building a plugin system into the application forces me to keep the customization interfaces clean and well-defined, plus opens up a whole world of use cases for Engineer that I won&#8217;t be able to imagine by&nbsp;myself.</p>
<p>I first tackled the plugin architecture in <a href="http://engineer.readthedocs.org/en/latest/changelog.html#version-0-2-4-may-27-2012">version 0.2.4</a>, with theme plugins. My idea was to provide a way to add themes to Engineer globally. Wrapping themes in a Python package made sense, since that way themes could be installed the same way Engineer itself is&nbsp;installed.</p>
<p>That was a fine system, and relatively simple (if not completely overkill since themes are really just <span class="caps">HTML</span>/<span class="caps">CSS</span>/JavaScript plus a little metadata file &#8211; not Python), but I really wanted a unified plugin system that worked similarly across all different plugin&nbsp;types.</p>
<p>In order to support post breaks or &#8216;teaser&#8217; content on a rollup page, I needed to break a post into two different pieces: the teaser content, and the full post. One option was to build a plugin to the Python Markdown engine. That seemed like overkill, plus frankly I didn&#8217;t want to go and learn a new <span class="caps">API</span> just for something simple. Also, it was unlikely that all future processing on post content I might want to do would be possible to do in a Markdown plugin, not to mention that I eventually want to support additional post formats (Textile, for&nbsp;example).</p>
<p>The second option was to simply bake the functionality into Engineer itself and add a new configuration option. This would have been fine, but it also seemed like a really good opportunity to work out a plugin architecture and use the post breaks feature, along with themes, as a test of the&nbsp;design.</p>
<p>After quite a bit of research and thought, I boiled down the design needs to two basic requirements. In order for a plugin system to work, you need to solve the following&nbsp;problems:</p>
<ol>
<li>The plugin has to be registered or discovered. Somehow, Engineer needs to know that the plugin code exists so that it can load it and run&nbsp;it.</li>
<li>Engineer needs to actually run the right plugin types at the right points in its&nbsp;execution.</li>
</ol>
<p>Both of these are pretty obvious, and the second one isn&#8217;t that challenging. There are different types of plugins, and those plugins get called based on their type wherever I see fit in the Engineer execution. Since I am defining the plugin&#8217;s capabilities (for a given type), then this is just simple common-sense&nbsp;coding.</p>
<p>The first problem, though, is somewhat more involved. Just <em>how</em> would Engineer know a plugin existed? How would it know what packages to load and what functions to call or classes to instantiate. Clearly I would need an interface defined, but should it be a class? Just a function? Something else? And even then, how will my code <em>find</em> the plugin&nbsp;code?</p>
<p>One option was to take a page from <a href="https://docs.djangoproject.com/en/1.4/ref/settings/#std:setting-INSTALLED_APPS">Django</a> and require the modules or classes be provided in a settings file,<sup id="fnref:eng1"><a class="footnote-ref" href="#fn:eng1" rel="footnote">1</a></sup> then import them at runtime, but that felt a little clunky. I want it to be possible to simply install the plugin and use it, especially for simple plugins that don&#8217;t require configuration (like themes and the post breaks&nbsp;plugin).</p>
<p>After further research, I came across a very simple model from <a href="http://martyalchin.com/2008/jan/10/simple-plugin-framework/">Marty Allchin</a> that seemed to meet my needs. I can define a class that defines a type of plugin, then plugin implementers can subclass that plugin parent class. The &#8216;magic&#8217; of Marty&#8217;s method is that all that&#8217;s required for plugins to get &#8216;loaded&#8217; is that the module containing them be imported. Once that happens, the plugin class is visible to Engineer. See <a href="http://martyalchin.com/2008/jan/10/simple-plugin-framework/">Marty&#8217;s post</a> for more details about how it works specifically, or you can look at <a href="https://github.com/tylerbutler/engineer/blob/master/engineer/plugins.py">plugins.py</a> to see my adapted implementation (I didn&#8217;t really change anything&nbsp;though).</p>
<p>That is very very awesome, and works especially well for built-in Engineer plugins since their modules are always loaded, but I still had the problem of loading plugins whose modules I don&#8217;t know about at runtime. I still needed the <a href="http://engineer.readthedocs.org/en/latest/settings.html#engineer.conf.EngineerConfiguration.PLUGINS"><span class="caps">PLUGINS</span> setting</a> to tell me which modules contained plugins so they could be loaded. Ultimately I <em>really</em> want plugins to be capable of working with no user configuration unless it&#8217;s needed due to the nature of the&nbsp;plugin.</p>
<p>Luckily, with some help from the Pygments source, I was able to find out about setuptools&#8217; <a href="http://peak.telecommunity.com/DevCenter/setuptools#extensible-applications-and-frameworks">entry points</a>, which work perfectly for this purpose. If you&#8217;re developing an Engineer plugin, you can notify Engineer about your plugin modules using the <code>engineer.plugins</code> entrypoint.</p>
<p>This is covered in more detail in the <a href="http://engineer.readthedocs.org/en/latest/dev/plugins.html#loading-plugins">Engineer documentation</a>, but basically you&#8217;d add something like this to your plugin&#8217;s <code>setup.py</code> file:</p>
<div class="codehilite"><pre><span class="n">entry_points</span> <span class="o">=</span> <span class="p">{</span>
<span class="s">&#39;engineer.plugins&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;post_processors=dotted.path.to.module&#39;</span><span class="p">,</span>
                     <span class="s">&#39;themes=another.module.path&#39;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>


<p>If you do that, then when your Python package is installed, it will advertise its modules to Engineer such that they can be imported, and then your plugins will run.&nbsp;Magic!</p>
<p>Like I said earlier, though, it&#8217;s still a work in progress. In particular, some of the limitations of the plugin system&nbsp;include:</p>
<ul>
<li>There is no notion of ordering plugins to run in a specific order. Currently this is not a problem, but I anticipate it becoming one fairly soon since plugins may eventually step on each others&#8217; toes. I&#8217;m not sure how I&#8217;m going to address this problem&nbsp;yet.</li>
<li>There is no general purpose &#8216;enable/disable plugin&#8217; feature &#8211; if it&#8217;s installed, it&#8217;ll run. Individual plugins can of course have their own toggles using custom settings, but it&#8217;s not built-in. I might leave this as something individual plugins will need to solve on their own, or I might implement a general-purpose &#8216;enabled/disabled by default&#8217; flag a plugin developer can set. I have to think about this more. Again &#8211; work in&nbsp;progress.</li>
</ul>
<p>Despite these limitations, the general plugin model is quite useable as-is, and I have a couple of new features I plan to add in version 0.4.0 that I intend to implement as plugins to further prove out the&nbsp;system.</p>
<h2>Jekyll/Octopress&nbsp;Compatibility</h2>
<p>When I started developing Engineer, I was heavily inspired by <a href="http://jekyllrb.com/">Jekyll</a> and <a href="http://octopress.org/">Octopress</a> (as well as <a href="http://hyde.github.com/">Hyde</a> and <a href="https://github.com/marcoarment/secondcrack">Second Crack</a>). There are a number of things I don&#8217;t like or find hard to understand about those applications, but they certainly do many things&nbsp;right.</p>
<p>But one of the biggest things Jekyll and Octopress have going for them is relative ubiquity, at least amongst the people that use static site generators (a much smaller crowd than it should be!). I honestly hadn&#8217;t considered doing any specific compatibility work, though, until I used <a href="http://markedapp.com">Marked</a> on the Mac. Marked is basically a Markdown previewer for the Mac. You type Markdown in one window, Marked shows you the output in another. Now it does other things too but that&#8217;s the core thing it&nbsp;does.</p>
<p>Anyway, there are other Markdown previewers/editors &#8211; notably <a href="http://markdownpad.com/">MarkdownPad</a> for Windows &#8211; but Marked has a unique feature that you can turn on that will ignore Jekyll metadata for the purposes of previewing a document. That means that if you&#8217;re editing a Jekyll post, Marked will hide the post metadata (Jekyll calls this &#8216;front matter&#8217;) in its preview. Contrast this to MarkdownPad, for example, which assumes the metadata is part of the document and renders it as&nbsp;Markdown.</p>
<p>Obviously this is not a required feature since Engineer metadata doesn&#8217;t <em>break</em> Markdown rendering, but it&#8217;s kind of nice to have when you&#8217;re writing/previewing a lot of posts. So I excitedly turned it on and loaded an Engineer post&#8230; and it didn&#8217;t work. The problem, of course, is that Jekyll requires that metadata (sorry, &#8216;front matter&#8217;) be &#8216;fenced&#8217; within two <span class="caps">YAML</span> document separators, like&nbsp;so:</p>
<div class="codehilite"><pre>---
metadata goes here...
---

post content goes here...
</pre></div>


<p>Engineer, on the other hand, required, (prior to version 0.3.0) that that first <code>---</code> not be there. Fundamental incompatibility. When I originally made the decision to not require the first <code>---</code> it was for simplicity. I didn&#8217;t need it for parsing, and it felt silly to <em>require</em> users to always type it, so I just left it out. However, this meant two&nbsp;things:</p>
<ol>
<li>I couldn&#8217;t use Marked&#8217;s nice Jekyll-compatibility feature for Engineer&nbsp;posts.</li>
<li>More importantly, users wouldn&#8217;t be able to easily migrate from Jekyll to&nbsp;Engineer.</li>
</ol>
<p>While getting people to use Engineer over Jekyll is not an explicit goal, I believe there&#8217;s room for more than one static site generator, and to the extent that I can encourage portability both to and from Engineer, I want to. So I addressed this in version 0.3.0: Engineer posts can now have Jekyll-style &#8216;fenced&#8217; metadata, or classic Engineer-style single <code>---</code> metadata. In addition, during normalization, Engineer will maintain the style of your source file. This isn&#8217;t merely a &#8216;migrate people to Engineer from Jekyll&#8217; feature. Rather, it&#8217;s a &#8216;increase compatibility and portability of your site&#8217;&nbsp;feature.</p>
<p>That&#8217;s the extent of the compatibility features in version 0.3.0, but I am going to keep looking for ways to increase the compatibility. In particular, some of the metadata keywords are different (e.g. Jekyll has categories <em>and</em> tags), and I&#8217;m looking into handling things like that as an <a href="https://trello.com/c/GIYzDoMz">optional post-processor</a> (using the new plugin system, of course!). There&#8217;s a lot of interesting stuff to look into, and I&#8217;d love input. Send it my way via a GitHub issue, or fork away and go nuts on the source&nbsp;yourself!</p>
<p>And if you have a website, consider using&nbsp;Engineer!</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:eng1">
<p>I actually ended up implementing this solution anyway since it seemed useful. See the <a href="http://engineer.readthedocs.org/en/latest/settings.html#engineer.conf.EngineerConfiguration.PLUGINS"><span class="caps">PLUGINS</span> setting</a>.&#160;<a class="footnote-backref" href="#fnref:eng1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                                                                                                                
                    <div class="row">
                        <div class="twelve columns post-links">
                            <ul class="block-grid two-up">
                                <li>
                                                                            <a href="/2012/08/ten-things-steve-bennett-hates-about-git/">← Ten Things Steve Bennett Hates About Git</a>
                                                                    </li>
                                <li>
                                                                            <a href="/2012/08/blog-portability/">Blog Portability →</a>
                                                                    </li>
                            </ul>
                        </div>
                    </div>
                                            </article>
            </div></section>
            </div>
        <div class="row">                <footer class="twelve columns centered">                        <p>&copy; 2002-2013 Tyler Butler. All rights reserved.</p>

<p>Powered by <a href="http://www.tylerbutler.com/projects/engineer">engineer</a>.</p>                    </footer>
            </div>
    </div>
                <script src="/static/engineer/lib/foundation/javascripts/foundation.js"></script>
        
    
    
</body>
</html>